<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8" />
<title>Vilin Mestari Sijoitus Voitot</title>
<style>
  body { font-family: Arial, sans-serif; margin: 2rem; background: #f4f4f4; }
  h1 { color: #2c3e50; }
  table {
    width: 100%; border-collapse: collapse; margin-top: 1rem;
    background: white; box-shadow: 0 0 5px rgba(0,0,0,0.1);
  }
  th, td {
    border: 1px solid #ccc; padding: 0.5rem; text-align: center;
  }
  th {
    background: #2980b9; color: white;
  }
  .profit { background: #d4edda; color: #155724; }
  .loss { background: #f8d7da; color: #721c24; }
  form {
    margin-bottom: 1rem;
  }
  label {
    margin-right: 0.5rem;
  }
  input, select {
    margin-right: 1rem;
  }
</style>
</head>
<body>

<h1>Vilin Mestari Sijoitus Voitot</h1>

<form id="skinForm">
  <label for="skinName">Skin:</label>
  <input type="text" id="skinName" required placeholder="Skinin nimi" />

  <label for="wear">Kulumamuoto:</label>
  <select id="wear" required>
    <option value="">Valitse</option>
    <option value="Factory New">Factory New</option>
    <option value="Minimal Wear">Minimal Wear</option>
    <option value="Field-Tested">Field-Tested</option>
    <option value="Well-Worn">Well-Worn</option>
    <option value="Battle-Scarred">Battle-Scarred</option>
  </select>

  <label for="buyPrice">Osto (€):</label>
  <input type="number" id="buyPrice" required min="0" step="0.01" />

  <label for="sellPrice">Myynti (€):</label>
  <input type="number" id="sellPrice" required min="0" step="0.01" />

  <label for="source">Lähde:</label>
  <select id="source" required>
    <option value="">Valitse</option>
    <option value="CSfloat">CSfloat</option>
    <option value="Steam">Steam</option>
  </select>

  <button type="submit">Lisää</button>
</form>
<div id="summary" style="margin: 20px 0; font-weight: bold;"></div>

<table id="skinsTable">
  <thead>
    <tr>
      <th>Skin</th>
      <th>Kulumamuoto</th>
      <th>Osto (€)</th>
      <th>Myynti (€)</th>
      <th>Ero (€)</th>
      <th>Ero (%)</th>
      <th>Poista</th>
    </tr>
  </thead>
  <tbody>
    <!-- Rivit tulevat tänne -->
  </tbody>
</table>

<script>
  const form = document.getElementById('skinForm');
  const tableBody = document.querySelector('#skinsTable tbody');
  const summary = document.getElementById('summary');

  let savedSkins = JSON.parse(localStorage.getItem('skins')) || [];

  // Lataa taulukko alussa
  renderTable();

  form.addEventListener('submit', function(event) {
    event.preventDefault();

    const skin = {
      name: document.getElementById('skinName').value.trim(),
      wear: document.getElementById('wear').value,
      buyPrice: parseFloat(document.getElementById('buyPrice').value),
      sellPrice: parseFloat(document.getElementById('sellPrice').value),
      source: document.getElementById('source').value,
    };

    savedSkins.push(skin);
    localStorage.setItem('skins', JSON.stringify(savedSkins));
    renderTable();
    form.reset();
  });

  function renderTable() {
    tableBody.innerHTML = "";
    let totalBuy = 0;
    let totalSell = 0;

    savedSkins.forEach((skin, index) => {
      const difference = skin.sellPrice - skin.buyPrice;
      const percentDiff = skin.buyPrice ? (difference / skin.buyPrice) * 100 : 0;
      const profitClass = difference >= 0 ? 'profit' : 'loss';

      totalBuy += skin.buyPrice;
      totalSell += skin.sellPrice;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${skin.name}</td>
        <td>${skin.wear}</td>
        <td>${skin.buyPrice.toFixed(2)}</td>
        <td>${skin.sellPrice.toFixed(2)}</td>
        <td class="${profitClass}">${difference >= 0 ? '+' : ''}${difference.toFixed(2)}</td>
        <td class="${profitClass}">${difference >= 0 ? '+' : ''}${percentDiff.toFixed(2)}%</td>
        <td>${skin.source}</td>
        <td><button onclick="deleteSkin(${index})">Poista</button></td>
      `;
      tableBody.appendChild(tr);
    });

    const totalDiff = totalSell - totalBuy;
    const totalPercent = totalBuy ? (totalDiff / totalBuy) * 100 : 0;
    const summaryColor = totalDiff >= 0 ? 'green' : 'red';

    summary.innerHTML = `
      Myyty yhteensä: ${totalSell.toFixed(2)} €<br>
      Ostettu yhteensä: ${totalBuy.toFixed(2)} €<br>
      <span style="color:${summaryColor}">
        Voitto/tappio yhteensä: ${totalDiff.toFixed(2)} € (${totalPercent.toFixed(2)}%)
      </span>
    `;
  }

  function deleteSkin(index) {
    savedSkins.splice(index, 1);
    localStorage.setItem('skins', JSON.stringify(savedSkins));
    renderTable();
  }
</script>

</body>
</html>
