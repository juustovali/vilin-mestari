<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vilin Mestari Sijoitus Voitot</title>
  <style>
   /* Pehmeä tumma teema smoothilla efekteillä */

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #121212;
  margin: 0;
  padding: 20px;
  color: #ddd;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  transition: background-color 0.5s ease;
}

h1, h2 {
  font-weight: 700;
  color: #ff6600;
  text-shadow: 0 2px 6px rgba(255,102,0,0.6);
  transition: color 0.3s ease;
}

.container {
  max-width: 960px;
  width: 100%;
  background: linear-gradient(145deg, #1f1f1f, #171717);
  box-shadow: 0 8px 20px rgba(255, 102, 0, 0.4);
  border-radius: 12px;
  padding: 40px 50px;
  box-sizing: border-box;
  transition: box-shadow 0.3s ease;
}

.container:hover {
  box-shadow: 0 10px 30px rgba(255, 102, 0, 0.6);
}

#user-info {
  margin-bottom: 30px;
  font-size: 1.15rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #2f2f2f;
  padding: 14px 25px;
  border-radius: 10px;
  box-shadow: inset 0 0 12px #ff6600cc;
  user-select: none;
  transition: background-color 0.4s ease;
}

#user-info:hover {
  background-color: #3b3b3b;
}

#user-info span {
  font-weight: 700;
  color: #ff6600;
  text-shadow: 0 1px 3px #bb4a00;
}

button {
  background: linear-gradient(145deg, #ff6f00, #ff5500);
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 12px;
  font-size: 1.1rem;
  cursor: pointer;
  transition: background 0.35s ease, box-shadow 0.35s ease;
  user-select: none;
  box-shadow: 0 5px 12px rgba(255, 102, 0, 0.7);
}
button:hover {
  background: linear-gradient(145deg, #ff8a1a, #ff6c00);
  box-shadow: 0 7px 18px rgba(255, 110, 0, 0.9);
}
button:disabled {
  background: #ffb87a;
  cursor: not-allowed;
  box-shadow: none;
  color: #4a2b00;
}

form#addSkinForm {
  margin-bottom: 40px;
  background: linear-gradient(160deg, #292929, #1b1b1b);
  border-radius: 14px;
  padding: 30px 30px;
  box-shadow: 0 6px 18px rgba(255, 102, 0, 0.15);
  transition: box-shadow 0.4s ease;
}
form#addSkinForm:hover {
  box-shadow: 0 8px 25px rgba(255, 102, 0, 0.3);
}

form#addSkinForm h2 {
  margin-top: 0;
  margin-bottom: 22px;
  font-size: 1.5rem;
  color: #ff6600;
  text-shadow: 0 1px 3px #bb4a00;
  letter-spacing: 1px;
}

form#addSkinForm label {
  display: block;
  margin-bottom: 14px;
  font-weight: 700;
  color: #ddd;
  letter-spacing: 0.5px;
}

form#addSkinForm input[type="text"],
form#addSkinForm input[type="number"],
form#addSkinForm select {
  width: 100%;
  padding: 12px 16px;
  font-size: 1rem;
  border: none;
  border-radius: 14px;
  box-sizing: border-box;
  background: #181818;
  color: #eee;
  box-shadow: inset 0 0 8px #333;
  transition: box-shadow 0.3s ease, background-color 0.3s ease;
}
form#addSkinForm input[type="text"]:focus,
form#addSkinForm input[type="number"]:focus,
form#addSkinForm select:focus {
  box-shadow: 0 0 12px #ff6600cc;
  outline: none;
  background: #220f00;
}

form#addSkinForm .buttons {
  margin-top: 28px;
  display: flex;
  gap: 20px;
}
form#addSkinForm .buttons button {
  flex: 1;
  font-weight: 700;
  letter-spacing: 0.8px;
  user-select: none;
  transition: transform 0.25s ease;
}
form#addSkinForm .buttons button:hover:not(:disabled) {
  transform: scale(1.05);
}

/* Tilastot */
#stats {
  margin-bottom: 40px;
  background: #3a3a3a;
  padding: 24px 36px;
  border-radius: 14px;
  box-shadow: inset 0 0 14px #ff6600cc;
  color: #ffad7a;
  font-weight: 600;
  letter-spacing: 0.4px;
  transition: background-color 0.3s ease;
}
#stats p {
  font-size: 1.15rem;
  margin: 10px 0;
}

/* Haku */
#searchInput {
  padding: 14px 20px;
  font-size: 1.1rem;
  border-radius: 14px;
  border: none;
  width: 100%;
  max-width: 320px;
  margin-bottom: 28px;
  background: #1e1e1e;
  color: #eee;
  box-shadow: inset 0 0 10px #333;
  transition: box-shadow 0.3s ease, background-color 0.3s ease;
}
#searchInput:focus {
  box-shadow: 0 0 14px #ff6600cc;
  outline: none;
  background: #2a1300;
}

/* Taulukko */
table#skinsTable {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0 8px;
  box-shadow: 0 4px 22px rgba(255, 102, 0, 0.4);
  border-radius: 14px;
  overflow: hidden;
  background: #252525;
  color: #ddd;
  transition: box-shadow 0.4s ease;
}
table#skinsTable:hover {
  box-shadow: 0 6px 30px rgba(255, 102, 0, 0.6);
}

table#skinsTable thead tr {
  background-color: #ff6600;
  color: #1e1e1e;
  user-select: none;
  border-radius: 14px 14px 0 0;
  box-shadow: 0 3px 12px #ff6600aa;
}
table#skinsTable thead th {
  padding: 14px 18px;
  font-weight: 700;
  font-size: 1.05rem;
  cursor: pointer;
  position: relative;
  user-select: none;
  transition: background-color 0.3s ease;
  border: none;
}
/* Lajittelun nuolet */
th.sort-asc::after,
th.sort-desc::after {
  content: '';
  position: absolute;
  right: 14px;
  top: 50%;
  transform: translateY(-50%);
  border: 7px solid transparent;
}
th.sort-asc::after {
  border-bottom-color: #1e1e1e;
}
th.sort-desc::after {
  border-top-color: #1e1e1e;
}

table#skinsTable tbody tr {
  background-color: #333333;
  box-shadow: 0 2px 6px #ff6600aa;
  border-radius: 14px;
  transition: background-color 0.3s ease;
}
table#skinsTable tbody tr:hover {
  background-color: #4d2a00;
  box-shadow: 0 3px 10px #ff6600cc;
  color: #fff;
}

table#skinsTable th, table#skinsTable td {
  padding: 14px 18px;
  text-align: center;
  border: none;
  user-select: none;
  font-weight: 600;
}

.profit {
  background-color: #4a7d15;
  color: #b9ff5a;
  font-weight: 700;
  border-radius: 10px;
  padding: 6px 12px;
  box-shadow: 0 2px 8px #aaff0033;
  transition: background-color 0.3s ease;
}
.loss {
  background-color: #8a1a1a;
  color: #ff7878;
  font-weight: 700;
  border-radius: 10px;
  padding: 6px 12px;
  box-shadow: 0 2px 8px #ff000033;
  transition: background-color 0.3s ease;
}

/* Toimintopainikkeet */
table#skinsTable button {
  background: linear-gradient(145deg, #cc5200, #e06400);
  padding: 8px 14px;
  font-size: 1rem;
  margin: 0 6px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(204, 82, 0, 0.8);
  color: #fff;
  font-weight: 700;
  cursor: pointer;
  user-select: none;
  transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.25s ease;
}
table#skinsTable button:hover {
  background: linear-gradient(145deg, #e07900, #cc5500);
  box-shadow: 0 6px 16px rgba(255, 105, 0, 1);
  transform: scale(1.1);
}

/* Responsiivisuus */
@media (max-width: 720px) {
  .container {
    padding: 30px 25px;
  }
  table#skinsTable th, table#skinsTable td {
    padding: 10px 8px;
    font-size: 0.9rem;
  }
  #searchInput {
    max-width: 100%;
  }
  form#addSkinForm label {
    font-size: 1rem;
  }
  form#addSkinForm input[type="text"],
  form#addSkinForm input[type="number"],
  form#addSkinForm select {
    font-size: 1rem;
  }
  button {
    font-size: 1rem;
    padding: 10px 16px;
  }
}


  </style>
</head>
<body>

  <div class="container">

    <h1>Vilin Mestari Sijoitus Voitot</h1>

    <div id="user-info" style="display:none;">
      Tervetuloa, <span id="user-name"></span>!
      <button id="logout-btn">Kirjaudu ulos</button>
    </div>
    <button id="login-btn">Kirjaudu Googlella</button>

    <form id="addSkinForm" style="display:none;">
      <h2>Lisää tai muokkaa skin</h2>
      <input type="hidden" id="editIndex" value="-1" />
      <label>
        Skinin nimi:
        <input type="text" id="skinName" required autocomplete="off" />
      </label>

      <label>
        Kulumamalli:
        <select id="wearLevel" required>
          <option value="Factory New">Factory New</option>
          <option value="Minimal Wear">Minimal Wear</option>
          <option value="Field Tested">Field Tested</option>
          <option value="Well Worn">Well Worn</option>
          <option value="Battle Scarred">Battle Scarred</option>
        </select>
      </label>

      <label>
        Osto (€/USD):
        <input type="number" step="0.01" id="buyPrice" required />
      </label>

      <label>
        Myynti (€/USD):
        <input type="number" step="0.01" id="sellPrice" required />
      </label>

      <label>
        Lähde ostolle:
        <select id="buySource" required>
          <option value="Steam Market">Steam Market</option>
          <option value="OP Skins">OP Skins</option>
          <option value="Third Party">Third Party</option>
        </select>
      </label>

      <div class="buttons">
        <button type="submit" id="addEditBtn">Lisää skin</button>
        <button type="button" id="cancelEditBtn" style="display:none;">Peruuta muokkaus</button>
      </div>
    </form>

    <input type="text" id="searchInput" placeholder="Hae skinejä nimellä tai lähteellä..." style="display:none;" />

    <div id="stats" style="display:none;">
      <p>Skinejä yhteensä: <span id="totalSkins">0</span></p>
      <p>Keskiosto: <span id="avgBuyPrice">0.00</span> €</p>
      <p>Keski-myyntihinta: <span id="avgSellPrice">0.00</span> €</p>
      <p>Keski-prosentti: <span id="avgProfitPercent">0.00</span> %</p>
    </div>

    <table id="skinsTable" style="display:none;">
      <thead>
        <tr>
          <th data-key="name">Skin</th>
          <th data-key="wear">Kulumamalli</th>
          <th data-key="buy">Osto (€)</th>
          <th data-key="sell">Myynti (€)</th>
          <th data-key="profit">Voitto (€)</th>
          <th data-key="profitPercent">Voitto (%)</th>
          <th data-key="source">Lähde</th>
          <th>Toiminnot</th>
        </tr>
      </thead>
      <tbody>
        <!-- Data lisääntyy tähän -->
      </tbody>
    </table>

  </div>

  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>

  <script>
    // Tässä sinun Firebase-konfiguraatiosi:
    const firebaseConfig = {
      apiKey: "AIzaSyDj3YnvlbQPM5yvlYTEohrup65bQCBbwDY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM-elementit
    const loginBtn = document.getElementById('login-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const userInfo = document.getElementById('user-info');
    const userNameSpan = document.getElementById('user-name');

    const addSkinForm = document.getElementById('addSkinForm');
    const skinNameInput = document.getElementById('skinName');
    const wearLevelSelect = document.getElementById('wearLevel');
    const buyPriceInput = document.getElementById('buyPrice');
    const sellPriceInput = document.getElementById('sellPrice');
    const buySourceSelect = document.getElementById('buySource');
    const addEditBtn = document.getElementById('addEditBtn');
    const cancelEditBtn = document.getElementById('cancelEditBtn');
    const editIndexInput = document.getElementById('editIndex');

    const searchInput = document.getElementById('searchInput');
    const statsDiv = document.getElementById('stats');
    const totalSkinsSpan = document.getElementById('totalSkins');
    const avgBuyPriceSpan = document.getElementById('avgBuyPrice');
    const avgSellPriceSpan = document.getElementById('avgSellPrice');
    const avgProfitPercentSpan = document.getElementById('avgProfitPercent');

    const skinsTable = document.getElementById('skinsTable');
    const skinsTableBody = skinsTable.querySelector('tbody');

    let skins = [];
    let sortKey = null;
    let sortAsc = true;

    // Google-kirjautuminen
    loginBtn.onclick = () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).catch(err => alert("Kirjautumisvirhe: " + err.message));
    };

    logoutBtn.onclick = () => auth.signOut();

    // Kuuntele kirjautumistila
    auth.onAuthStateChanged(user => {
      if (user) {
        userNameSpan.textContent = user.displayName;
        loginBtn.style.display = 'none';
        userInfo.style.display = 'flex';
        addSkinForm.style.display = 'block';
        searchInput.style.display = 'block';
        statsDiv.style.display = 'block';
        skinsTable.style.display = 'table';

        // Lataa skinit Firestoresta käyttäjäkohtaisesti
        loadSkins(user.uid);
      } else {
        userNameSpan.textContent = '';
        loginBtn.style.display = 'block';
        userInfo.style.display = 'none';
        addSkinForm.style.display = 'none';
        searchInput.style.display = 'none';
        statsDiv.style.display = 'none';
        skinsTable.style.display = 'none';

        skins = [];
        renderSkins();
        clearForm();
      }
    });

    function loadSkins(uid) {
      // Firestore: Kuuntele reaaliaikaisesti käyttäjän skin-kokoelmaa
      db.collection('users').doc(uid).collection('skins')
        .onSnapshot(snapshot => {
          skins = [];
          snapshot.forEach(doc => {
            skins.push({...doc.data(), id: doc.id});
          });
          renderSkins();
          calculateStats();
        }, error => {
          alert("Virhe tietojen latauksessa: " + error.message);
        });
    }

    // Lomakkeen lähetys (lisää/muokkaa)
    addSkinForm.onsubmit = e => {
      e.preventDefault();

      const skinData = {
        name: skinNameInput.value.trim(),
        wear: wearLevelSelect.value,
        buy: parseFloat(buyPriceInput.value),
        sell: parseFloat(sellPriceInput.value),
        source: buySourceSelect.value
      };

      if (skinData.name === '' || isNaN(skinData.buy) || isNaN(skinData.sell)) {
        alert('Täytä kaikki kentät oikein!');
        return;
      }

      const user = auth.currentUser;
      if (!user) return alert('Et ole kirjautunut sisään!');

      const skinId = editIndexInput.value;
      if (skinId === '-1') {
        // Lisää uusi
        db.collection('users').doc(user.uid).collection('skins').add(skinData).then(() => {
          clearForm();
        }).catch(err => alert('Virhe lisättäessä: ' + err.message));
      } else {
        // Päivitä olemassaoleva
        db.collection('users').doc(user.uid).collection('skins').doc(skinId).update(skinData).then(() => {
          clearForm();
        }).catch(err => alert('Virhe päivitettäessä: ' + err.message));
      }
    };

    cancelEditBtn.onclick = () => clearForm();

    // Tyhjennä lomake ja palauta oletukset
    function clearForm() {
      editIndexInput.value = '-1';
      skinNameInput.value = '';
      wearLevelSelect.value = 'Factory New';
      buyPriceInput.value = '';
      sellPriceInput.value = '';
      buySourceSelect.value = 'Steam Market';
      addEditBtn.textContent = 'Lisää skin';
      cancelEditBtn.style.display = 'none';
    }

    // Renderöi taulukko skineistä
    function renderSkins() {
      // Suodata haun mukaan
      const filterText = searchInput.value.trim().toLowerCase();
      let filtered = skins.filter(skin => 
        skin.name.toLowerCase().includes(filterText) ||
        skin.source.toLowerCase().includes(filterText)
      );

      // Lajittele
      if (sortKey) {
        filtered.sort((a,b) => {
          let valA = a[sortKey];
          let valB = b[sortKey];
          // Jos numerot, vertaa numeerisesti
          if(sortKey === 'buy' || sortKey === 'sell' || sortKey === 'profit' || sortKey === 'profitPercent') {
            valA = (sortKey === 'profit' || sortKey === 'profitPercent') ? (a.sell - a.buy) : valA;
            valB = (sortKey === 'profit' || sortKey === 'profitPercent') ? (b.sell - b.buy) : valB;
            return sortAsc ? valA - valB : valB - valA;
          }
          // Muuten merkkijonovertailu
          if(valA < valB) return sortAsc ? -1 : 1;
          if(valA > valB) return sortAsc ? 1 : -1;
          return 0;
        });
      }

      skinsTableBody.innerHTML = '';
      if(filtered.length === 0){
        skinsTableBody.innerHTML = `<tr><td colspan="8" style="text-align:center; padding:20px; color:#888;">Ei näytettäviä skinejä</td></tr>`;
        return;
      }

      for (const skin of filtered) {
        const profit = skin.sell - skin.buy;
        const profitPercent = (profit / skin.buy) * 100;
        const profitClass = profit >= 0 ? 'profit' : 'loss';

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${skin.name}</td>
          <td>${skin.wear}</td>
          <td>${skin.buy.toFixed(2)}</td>
          <td>${skin.sell.toFixed(2)}</td>
          <td class="${profitClass}">${profit.toFixed(2)}</td>
          <td class="${profitClass}">${profitPercent.toFixed(2)}%</td>
          <td>${skin.source}</td>
          <td>
            <button onclick="editSkin('${skin.id}')">Muokkaa</button>
            <button onclick="deleteSkin('${skin.id}')">Poista</button>
          </td>
        `;
        skinsTableBody.appendChild(tr);
      }
    }

    // Muokkaa skinia
    window.editSkin = function(id) {
      const skin = skins.find(s => s.id === id);
      if (!skin) return;
      editIndexInput.value = skin.id;
      skinNameInput.value = skin.name;
      wearLevelSelect.value = skin.wear;
      buyPriceInput.value = skin.buy;
      sellPriceInput.value = skin.sell;
      buySourceSelect.value = skin.source;
      addEditBtn.textContent = 'Tallenna muutokset';
      cancelEditBtn.style.display = 'inline-block';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    // Poista skin
    window.deleteSkin = function(id) {
      if (!confirm('Haluatko varmasti poistaa tämän skinin?')) return;
      const user = auth.currentUser;
      if (!user) return alert('Et ole kirjautunut sisään!');
      db.collection('users').doc(user.uid).collection('skins').doc(id).delete()
        .catch(err => alert('Virhe poistettaessa: ' + err.message));
    };

    // Päivitä tilastot
    function calculateStats() {
      if (skins.length === 0) {
        totalSkinsSpan.textContent = '0';
        avgBuyPriceSpan.textContent = '0.00';
        avgSellPriceSpan.textContent = '0.00';
        avgProfitPercentSpan.textContent = '0.00';
        return;
      }
      const total = skins.length;
      const sumBuy = skins.reduce((a, s) => a + s.buy, 0);
      const sumSell = skins.reduce((a, s) => a + s.sell, 0);
      const sumProfitPercent = skins.reduce((a, s) => a + ((s.sell - s.buy) / s.buy) * 100, 0);

      totalSkinsSpan.textContent = total;
      avgBuyPriceSpan.textContent = (sumBuy / total).toFixed(2);
      avgSellPriceSpan.textContent = (sumSell / total).toFixed(2);
      avgProfitPercentSpan.textContent = (sumProfitPercent / total).toFixed(2);
    }

    // Haku
    searchInput.oninput = () => renderSkins();

    // Taulukon otsikot lajitteluun
    document.querySelectorAll('#skinsTable thead th[data-key]').forEach(th => {
      th.addEventListener('click', () => {
        const key = th.getAttribute('data-key');
        if (sortKey === key) {
          sortAsc = !sortAsc;
        } else {
          sortKey = key;
          sortAsc = true;
        }
        // Poista lajittelun merkit muista sarakkeista
        document.querySelectorAll('#skinsTable thead th').forEach(h => h.classList.remove('sort-asc','sort-desc'));
        th.classList.add(sortAsc ? 'sort-asc' : 'sort-desc');
        renderSkins();
      });
    });

  </script>

</body>
</html>