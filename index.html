<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vilin Mestari Sijoitus Voitot</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background: #f0f0f0; }
  .profit { background-color: #d4f4dd; }  /* vihreä voitto */
  .loss { background-color: #f4d4d4; }    /* punainen tappio */
  button { margin: 0 3px; }
  label { margin-right: 10px; }
  select { margin-right: 20px; }
  .hidden { display: none; }
</style>
</head>
<body>

<h1>Vilin Mestari Sijoitus Voitot</h1>

<form id="addSkinForm">
  <label>
    Skinin nimi:
    <input type="text" id="skinName" required />
  </label>
  <label>
    Kulumamalli:
    <select id="wearCondition" required>
      <option value="Factory New">Factory New</option>
      <option value="Minimal Wear">Minimal Wear</option>
      <option value="Field Tested">Field Tested</option>
      <option value="Well Worn">Well Worn</option>
      <option value="Battle Scarred">Battle Scarred</option>
    </select>
  </label>
  <label>
    Ostohinta (€):
    <input type="number" id="buyPrice" min="0" step="0.01" required />
  </label>
  <label>
    Myyntihinta (€):
    <input type="number" id="sellPrice" min="0" step="0.01" required />
  </label>
  <button type="submit">Lisää skin</button>
</form>

<!-- Suodatus -->
<div style="margin-top:20px;">
  <label for="filterWear">Suodata kulumamallin mukaan:</label>
  <select id="filterWear">
    <option value="all">Kaikki</option>
    <option value="Factory New">Factory New</option>
    <option value="Minimal Wear">Minimal Wear</option>
    <option value="Field Tested">Field Tested</option>
    <option value="Well Worn">Well Worn</option>
    <option value="Battle Scarred">Battle Scarred</option>
  </select>

  <label for="filterProfit">Suodata voiton mukaan:</label>
  <select id="filterProfit">
    <option value="all">Kaikki</option>
    <option value="profit">Vain voitot</option>
    <option value="loss">Vain tappiot</option>
  </select>
</div>

<!-- Taulukko -->
<table id="skinsTable">
  <thead>
    <tr>
      <th>Skinin nimi</th>
      <th>Kulumamalli</th>
      <th>Ostohinta (€)</th>
      <th>Myyntihinta (€)</th>
      <th>Ero (€)</th>
      <th>Ero (%)</th>
      <th>Toiminnot</th>
    </tr>
  </thead>
  <tbody>
    <!-- rivit lisätään JavaScriptillä -->
  </tbody>
  <tfoot>
    <tr>
      <td colspan="4" style="text-align:right;"><strong>Yhteensä:</strong></td>
      <td id="totalDiffAmount">0.00</td>
      <td id="totalDiffPercent">0.00 %</td>
      <td></td>
    </tr>
  </tfoot>
</table>

<script>
  let skins = [];

  const form = document.getElementById('addSkinForm');
  const tableBody = document.querySelector('#skinsTable tbody');
  const filterWear = document.getElementById('filterWear');
  const filterProfit = document.getElementById('filterProfit');
  const totalDiffAmount = document.getElementById('totalDiffAmount');
  const totalDiffPercent = document.getElementById('totalDiffPercent');

  function calculateDifference(buy, sell) {
    const diff = sell - buy;
    const diffPercent = buy === 0 ? 0 : (diff / buy) * 100;
    return { diff, diffPercent };
  }

  function renderTable() {
    tableBody.innerHTML = '';

    // Suodatetaan
    let filteredSkins = skins.filter(skin => {
      if(filterWear.value !== 'all' && skin.wear !== filterWear.value) return false;
      if(filterProfit.value === 'profit' && skin.diff <= 0) return false;
      if(filterProfit.value === 'loss' && skin.diff >= 0) return false;
      return true;
    });

    // Lasketaan summat
    let totalDiff = 0;
    let totalBuy = 0;
    filteredSkins.forEach(skin => {
      totalDiff += skin.diff;
      totalBuy += skin.buyPrice;
    });

    // Lisätään rivit taulukkoon
    filteredSkins.forEach((skin, index) => {
      const tr = document.createElement('tr');
      tr.className = skin.diff > 0 ? 'profit' : 'loss';

      tr.innerHTML = `
        <td>${skin.name}</td>
        <td>${skin.wear}</td>
        <td>${skin.buyPrice.toFixed(2)}</td>
        <td>${skin.sellPrice.toFixed(2)}</td>
        <td>${skin.diff.toFixed(2)}</td>
        <td>${skin.diffPercent.toFixed(2)}%</td>
        <td>
          <button onclick="editSkin(${index})">Muokkaa</button>
          <button onclick="deleteSkin(${index})">Poista</button>
        </td>
      `;

      tableBody.appendChild(tr);
    });

    // Päivitä footer summat
    totalDiffAmount.textContent = totalDiff.toFixed(2);
    const totalDiffPercentCalc = totalBuy === 0 ? 0 : (totalDiff / totalBuy) * 100;
    totalDiffPercent.textContent = totalDiffPercentCalc.toFixed(2) + ' %';
  }

  form.addEventListener('submit', e => {
    e.preventDefault();

    const name = document.getElementById('skinName').value.trim();
    const wear = document.getElementById('wearCondition').value;
    const buyPrice = parseFloat(document.getElementById('buyPrice').value);
    const sellPrice = parseFloat(document.getElementById('sellPrice').value);

    if (!name || isNaN(buyPrice) || isNaN(sellPrice)) return;

    const { diff, diffPercent } = calculateDifference(buyPrice, sellPrice);

    skins.push({ name, wear, buyPrice, sellPrice, diff, diffPercent });

    form.reset();
    renderTable();
  });

  window.editSkin = function(index) {
    const skin = skins[index];
    document.getElementById('skinName').value = skin.name;
    document.getElementById('wearCondition').value = skin.wear;
    document.getElementById('buyPrice').value = skin.buyPrice;
    document.getElementById('sellPrice').value = skin.sellPrice;

    // Poistetaan vanha rivi ennen uuden lisäämistä, koska muokataan
    skins.splice(index, 1);
    renderTable();
  };

  window.deleteSkin = function(index) {
    if(confirm('Haluatko varmasti poistaa tämän skinin?')) {
      skins.splice(index, 1);
      renderTable();
    }
  };

  filterWear.addEventListener('change', renderTable);
  filterProfit.addEventListener('change', renderTable);

  renderTable();
</script>

</body>
</html>
